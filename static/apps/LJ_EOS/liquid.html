<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LJ EOS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <link href='main.css' rel='stylesheet'>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.10.3/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.10.3/brython_stdlib.js"></script>
    <script type='text/javascript' src='util.js'></script>
    <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
  </head>
  <body onload='brython()'>
    <script type='text/javascript'>
document.title = "LJ EOS for Liquid";
      function myUpdatePlot() {
        updatePlot();
      }
      window.addEventListener("load", updateLiquidRc);
      window.addEventListener("load", function() {
        updateRhoP();
        updateX();
        var plotModalEl = document.getElementById("plotModal");
        plotModalEl.addEventListener("show.bs.modal", myUpdatePlot);
      });

    </script>
    <script type='text/python' src='LJ_EOS.py'></script>
    <script type='text/python' src='EOS_util.py'></script>
    <script type='text/python'>
      from browser import document, window.timer
      from browser.widgets.dialog import InfoDialog
      from LJ_EOS import getEOS
      from EOS_util import optsForPhase

      phaseName = "liquid"


      def gimmeRhoSimple(T, rhostr, Pstr, x, eos, doc):
        if doc["checkP"].checked:
          P = eval(Pstr)
          rho = eos.rhoForProps(T, {'P': P})
        else:
          rho = eval(rhostr)
        return rho

      thisGimmeRho = gimmeRhoSimple
      myInterval = None
      ix = 0

      def doOnePoint(stuff):
        global myInterval, ix, thisGimmeRho
        doc,eos,myGimmeRho = stuff
        numX = int(doc["inputXnum"].value)
        if ix > numX:
          stopUpdate()
        x = ix / numX
        ix = ix + 1
        Tstr = doc['inputT'].value
        Pstr = doc['inputP'].value
        rhostr = doc['inputRho'].value
        T = eval(Tstr)
        rho = myGimmeRho(T, rhostr, Pstr, x, eos, doc)
        props = eos.eval(T,rho)
        window.addParametricRow(T, rho, props)
        if ix > numX:
          stopUpdate()

      def stopUpdate():
        global myInterval
        timer.clear_interval(myInterval)
        document["btnUpdate"].textContent = "Update"
        myInterval = None
        print("stopped")

      def update(ev):
        global myInterval, ix, phaseName
        if not myInterval == None:
          stopUpdate()
          return
        window.clearAllSimple()

        B3callback = None
        if 'grabB3' in window:
          B3callback = window.grabB3

        opts = optsForPhase(phaseName, document, B3callback)
        eos = getEOS(phaseName, opts)

        useX = document["checkX"].checked
        if useX:
          document["btnUpdate"].textContent = "Stop"
          ix = 0
          numX = int(document["inputXnum"].value)
          if numX < 1:
            InfoDialog("Trouble", f"Need at least 1 x value")
            return
          myInterval = timer.set_interval(doOnePoint, 0, [document,eos,thisGimmeRho])
          return

        Tstr = document['inputT'].value
        Pstr = document['inputP'].value
        rhostr = document['inputRho'].value

        try:
          T = float(Tstr)
        except ValueError:
          InfoDialog("Trouble", f"Must provide a valid temperature")
          return
        rho = thisGimmeRho(T, rhostr, Pstr, 0, eos, document)
        props = eos.eval(T,rho)
        window.showResults(T, rho, props)

      document["btnUpdate"].bind("click", update)

    </script>
    <div class='container'>
      <h1>Equation of state for liquid phase of LJ</h1>

      <div id='parametersDiv' class='card mb-4'>
        <div id='headingParameters' class='card-header' role='tab'>
          <h2 class='h5 mb-0'>State Condition</a></h2>
        </div>
        <div class='show' aria-labelledby='headingParameters'>
          <div class='card-body'>
            <div class='row'>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputT' class='col-form-label'>T</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputT' class='form-control'>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputRho' class='col-form-label'>&rho;</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputRho' class='form-control'>
                  </div>
                  <div class='col-auto' class=form-check' style='display: none'>
                    <input class='form-check-input' type='checkbox' value='' id='checkNrho'>
                    <label class='form-check-label' for='checkNrho' data-bs-toggle="tooltip" data-bs-placement="right" title="given density will be imposed as atomic rather than as a site density">atom density</label>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputP' class='col-form-label'>P</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputP' class='form-control' disabled>
                  </div>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkP' onclick='updateRhoP()'>
                    <label class='form-check-label' for='checkP'>compute &rho; for P</label>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputXnum' class='col-form-label'>#</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputXnum' class='form-control' disabled placeholder='# of x values'>
                  </div>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkX' onclick='updateX()'>
                    <label class='form-check-label' for='checkX' data-bs-toggle="tooltip" data-bs-placement="right" title="T, rho, P will vary parametrically as a function of x.  The number of points is given here.  T, rho and P can be simple (1+x) or more complex python expressions (1-math.exp(x))">use T(x), &rho;(x) P(x) (0&lt;=x&lt;=1)</label>
                  </div>
                </div>
              </div>
            </div>
            <div class='row g-3 py-1 align-items-center'>
              <div class='col-auto'>
                <button id='btnUpdate' class='btn btn-sm btn-primary' type='button'>Update</button>
                <button id='btnDoc' class='btn btn-sm btn-info' type='button' data-bs-toggle="modal" data-bs-target="#infoEOSModal">Info</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    <div class="modal fade" id="infoEOSModal" tabindex="-1" aria-labelledby="infoEOSModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="infoEOSModalLabel">EOS Info</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>The EOS pages allows you to generate thermodynamic properties as a function of temperature, density or pressure.  The page can operate in one of two modes.</p>
            <ol>
              <li>In the first mode, you can compute properties at a single given state point.  You must choose the temperature and then either the density or pressure.  If setting the pressure, the EOS will be used to determine the density for that pressure (be careful to choose a pressure that exists at the given temperature). Results are presented in a simple table.</li>
              <li>In the second mode, you can compute properties at a series of state points.  As in the first mode, you can set the temperature and either the density or pressure.  Now, however, each may be expressed as a function of a parametric varialbe, <i>x</i>.  The <i>x</i> variable varies from 0 to 1 (inclusive) visiting as many points you specify in the # input field (it will actually visit one additional point; if you specific "100", x will take values 0, 0.01, 0.02..., 1.0).  The properties are reported in a table with a column for each property and a row for each state point.  You may copy all of the data as comma-separated data or also open a plot.  For the plot, you can choose the properties plotted for the x and y axes.  You may copy data or open the plot while the data is generated, but the page may be slow to respond.</li>
            </ol>

            <p>You can choose the EOS to use to generate properties.  The citation is provided for the chosen EOS.  Each EOS has its own limits on range of applicability (temperatures and densities, etc).  Please refer to the published paper for details.  Different EOS choices may also result in different available properties due to complexity of property calcluation (such as C<sub>V</sub>).</p>
            <p>If you choose the Schultz EOS, then there are various additional parameters that can be set.  This allows you to examine approximations such as using the harmonic approximation or examining the effects of finite system size and potential truncation.  The properties computed may depend on the parameters chose; vacancy fraction will be reported if they are included in the EOS, but C<sub>V</sub> will not because the vacancy contribution to C<sub>V</sub> is too complicated.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

      <div id='parametersDiv-liquid' class='card mb-4'>
        <div id='headingParameters-liquid' class='card-header' role='tab'>
          <h2 class='h5 mb-0'><a role='button' data-bs-toggle='collapse' href='#collapseparametersDiv-liquid' aria-expanded='true' aria-controls='colapseparametersDiv-liquid'>Liquid Parameters</a></h2>
        </div>
        <div id='collapseparametersDiv-liquid' class='collapse show' role='tabpanel' aria-labelledby='headingParameters-liquid'>
          <div class='card-body'>
            <div class='row'>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputEOS-liquid' class='col-form-label'>EOS</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputEOS-liquid' onchange='phaseChoiceUpdated("liquid")'>
                      <option value='Schultz' selected>Schultz</option>
                      <option value='Johnson'>Johnson</option>
                      <option value='Kolafa'>Kolafa</option>
                      <option value='May'>May</option>
                      <option value='Thol'>Thol</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputNl' class='col-form-label'># of atoms</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputNl'>
                      <option value='0' selected>&infin;</option>
                      <option value='4000'>4000</option>
                      <option value='2000'>2000</option>
                      <option value='1000'>1000</option>
                      <option value='500'>500</option>
                      <option value='250'>250</option>
                    </select>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='rc-liquid' class='col-form-label'>cutoff</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputRc-liquid'>
                      <option value='-1' selected>&infin;</option>
                      <option value='9'>9</option>
                      <option value='8'>8</option>
                      <option value='7'>7</option>
                      <option value='6'>6</option>
                      <option value='5'>5</option>
                      <option value='4'>4</option>
                      <option value='3'>3</option>
                      <option value='2'>2</option>
                      <option value='1'>1</option>
                      <option value='0'>0</option>
                    </select>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkLRC-liquid'>
                    <label class='form-check-label' for='checkLRC-liquid'>include LRC</label>
                  </div>
                </div>
              </div>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='citation' id='liquid-ref-Schultz'>EOS Citation: A. J. Schultz, D. A. Kofke, "<a href='https://doi.org/10.1063/1.5053714'>Comprehensive high-precision high-accuracy equation of state and coexistence properties for classical Lennard-Jones crystals and low-temperature fluid phases</a>", <span class='pubName'>J. Chem. Phys.</span> <span class='volume'>149</span>, 204508 (2018).</div>
                  <div class='citation' id='liquid-ref-Johnson'>EOS Citation: J. Johnson, J. Zollweg, and K. Gubbins, "<a href='https://doi.org/10.1080/00268979300100411'>The Lennard-Jones equation of state revisited</a>", <span class='pubName'>Mol. Phys.</span> <span class='volume'>78</span>, 591–618 (1993).</div>
                  <div class='citation' id='liquid-ref-Kolafa'>EOS Citation: J. Kolafa and I. Nezbeda, "<a href='https://doi.org/10.1016/0378-3812(94)80001-4'>The Lennard-Jones fluid: An accurate analytic and theoretically-based equation of state</a>", <span class='pubName'>Fluid Phase Equilib.</span> <span class='volume'>100</span>, 1 (1994).</div>
                  <div class='citation' id='liquid-ref-May'>EOS Citation: H.-O. May and P. Mausbach, "<a href='https://doi.org/10.1103/PhysRevE.85.031201'>Riemannian geometry study of vapor-liquid phase equilibria and supercritical behavior of the Lennard-Jones fluid</a>", <span class='pubName'>Phys. Rev. E</span> <span class='volume'>86</span>, 059905 (2012).</div>
                  <div class='citation' id='liquid-ref-Thol'>EOS Citation: M. Thol, G. Rutkai, A. K ̈oster, R. Lustig, R. Span, and J. Vrabec, "<a href='https://doi.org/10.1063/1.4945000'>Equation of state for the Lennard-Jones fluid</a>", <span class='pubName'>J. Phys. Chem. Ref. Data</span> <span class='volume'>45</span>, 023101 (2016).</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <div id='resultsDiv' class='card'>
        <div id='headingResults' class='card-header' role='tab'>
          <h2 class='h5 mb-0' style='float: left'>Results</a></h2>
          <button class='btn btn-info btn-sm' style='float: right' onclick='copyToClipboard(copyText)' id='copyBtn'>Copy</button>
          <button class='btn btn-info btn-sm' style='margin-right: 1rem; float: right' id='plotBtn' data-bs-toggle="modal" data-bs-target="#plotModal">Plot</button>
        </div>
        <div class='show' aria-labelledby='headingResults'>
          <div class='card-body'>
            <div id='singleResultsDiv'>
              <p id='T_row'>T: <span id='T'></span></p>
              <p id='rho_row'>&rho;: <span id='rho'></span></p>
              <p id='P_row'>P: <span id='P'></span></p>
              <p id='U_row'>U: <span id='U'></span></p>
              <p id='A_row'>A: <span id='A'></span></p>
              <p id='G_row'>G: <span id='G'></span></p>
              <p id='Z_row'>Z: <span id='Z'></span></p>
              <p id='Cv_row'>Cv: <span id='Cv'></span></p>
              <p id='phi_row'>&phi;: <span id='phi'></span></p>
              <p id='alpha_row'>&alpha;: <span id='alpha'></span></p>
            </div>
            <div class='overflow-auto' id='parametricResultsDiv' style='display: none;'>
              <table class='table small'>
                <thead><tr id='parametricTH'><th id='T_col'>T</th><th id='rho_col'>&rho;</th><th id='P_col'>P</th><th id='U_col'>U</th><th id='A_col'>A</th><th id='G_col'>G</th><th id='Z_col'>Z</th><th id='Cv_col'>Cv</th><th id='phi_col'>&phi;</th><th id='alpha_col'>&alpha;</th></tr></thead>
                <tbody id='parametricResults'></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>


    <div class="modal fade" id="plotModal" tabindex="-1" aria-labelledby="plotModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="plotModalLabel">Plot</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="plotDiv" style="width:100%;height:500px;"></div>
            <div class='row'>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputXprop' class='col-form-label'>X:</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputXprop' onchange='myUpdatePlot()'>
                      <option value='T'>T</option>
                      <option value='rho' selected>&rho;</option>
                      <option value='P'>P</option>
                      <option value='U'>U</option>
                      <option value='A'>A</option>
                      <option value='G'>G</option>
                      <option value='Z'>Z</option>
                      <option value='Cv'>Cv</option>
                      <option value='phi'>&phi;</option>
                      <option value='alpha'>&alpha;</option>
                      <option value='v2'>v2</option>
                      <option value='Y'>Y</option>
                      <option value='H'>H</option>
                      <option value='S'>S</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputYprop' class='col-form-label'>Y:</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputYprop' onchange='myUpdatePlot()'>
                      <option value='T'>T</option>
                      <option value='rho'>&rho;</option>
                      <option value='P' selected>P</option>
                      <option value='U'>U</option>
                      <option value='A'>A</option>
                      <option value='G'>G</option>
                      <option value='Z'>Z</option>
                      <option value='Cv'>Cv</option>
                      <option value='phi'>&phi;</option>
                      <option value='alpha'>&alpha;</option>
                      <option value='v2'>v2</option>
                      <option value='Y'>Y</option>
                      <option value='H'>H</option>
                      <option value='S'>S</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='plotXDiff' onchange='myUpdatePlot()'>
                    <label class='form-check-label' for='plotXDiff' data-bs-toggle="tooltip" data-bs-placement="right" title="Plot a single set as the value for phase2 - phase1 instead of separate sets">X diff</label>
                  </div>
                </div>
              </div>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='plotYDiff' onchange='myUpdatePlot()'>
                    <label class='form-check-label' for='plotXDiff' data-bs-toggle="tooltip" data-bs-placement="right" title="Plot a single set as the value for phase2 - phase1 instead of separate sets">Y diff</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
