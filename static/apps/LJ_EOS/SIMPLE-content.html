    <script type='text/python'>
      from browser import document, window, timer
      window.removeBrythonSpinner()
      from browser.widgets.dialog import InfoDialog
      from LJ_EOS import getEOS
      from EOS_util import optsForPhase
      import math

      myInterval = None
      success = False
      ix = 0

      def gimmeRhoSimple(T, rhostr, Pstr, x, eos, doc):
        if doc["checkP"].checked:
          try:
            P = eval(Pstr)
          except Exception as err:
            window.alert("Trouble parsing P expression: {0}".format(err))
            return float("nan")
          return eos.rhoForProps(T, {'P': P})

        try:
          rho = eval(rhostr)
        except Exception as err:
          window.alert("Trouble parsing rho expression: {0}".format(err))
          return float("nan")
        if document["phase1"].value == "fcc" and type(eos).__name__ == "Schultz" and doc["checkNrho"].checked:
          rho = eos.latRhoForNRho(T, rho)
        return rho


      def doOnePoint(stuff):
        global myInterval, ix, success
        if not success:
          window.alert("Unexpected trouble while stepping through x")
          stopUpdate()
          return
        success = False
        doc,eos,myGimmeRho = stuff
        try:
          numX = int(doc["inputXnum"].value)
        except ValueError:
          window.alert("Must provide a valid # of x points")
          stopUpdate()
          return
        x = ix / numX
        ix = ix + 1
        Tstr = doc['inputT'].value
        Pstr = doc['inputP'].value
        rhostr = doc['inputRho'].value
        try:
          T = eval(Tstr)
        except Exception as err:
          window.alert("Trouble parsing T expression: {0}".format(err))
          stopUpdate()
          return
        rho = myGimmeRho(T, rhostr, Pstr, x, eos, doc)
        if math.isnan(rho):
          stopUpdate()
          return
        props = eos.eval(T,rho)
        Bvalues = None
        phase1 = document["phase1"].value
        if phase1 == "vapor" and type(eos).__name__ == "VEOS":
          Bvalues = eos.B
        window.addParametricRow(T, rho, props, Bvalues)
        success = True
        if ix > numX:
          stopUpdate()

      def stopUpdate():
        global myInterval
        timer.clear_interval(myInterval)
        document["btnUpdate"].textContent = "Update"
        myInterval = None
        success = False
        print("stopped")

      def update(ev):
        global myInterval, ix, success
        if not myInterval == None:
          stopUpdate()
          return
        window.clearAllSimple()

        B3callback = None
        if 'grabB3' in window:
          B3callback = window.grabB3

        phase1 = document["phase1"].value
        opts = optsForPhase(phase1, document, B3callback)
        if isinstance(opts,str):
          window.alert(opts)
          return
        eos = getEOS(phase1, opts)

        useX = document["checkX"].checked
        if useX:
          document["btnUpdate"].textContent = "Stop"
          ix = 0
          try:
            numX = int(document["inputXnum"].value)
          except ValueError:
            window.alert("Must provide a valid # of x points")
            return
          if numX < 1:
            window.alert("Need at least 1 x value")
            return
          success = True
          myInterval = timer.set_interval(doOnePoint, 0, [document,eos,gimmeRhoSimple])
          return

        Tstr = document['inputT'].value
        Pstr = document['inputP'].value
        rhostr = document['inputRho'].value

        try:
          T = float(Tstr)
        except ValueError:
          window.alert("Must provide a valid temperature")
          return
        rho = gimmeRhoSimple(T, rhostr, Pstr, 0, eos, document)
        if math.isnan(rho):
          stopUpdate()
          return
        props = eos.eval(T,rho)
        Bvalues = None
        if phase1 == "vapor" and type(eos).__name__ == "VEOS":
          Bvalues = eos.B
        window.showResults(T, rho, props, Bvalues)

      document["btnUpdate"].bind("click", update)
    </script>
