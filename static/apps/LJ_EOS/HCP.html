<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>LJ EOS for HCP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <link href='main.css' rel='stylesheet'>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.10.3/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.10.3/brython_stdlib.js"></script>
    <script type='text/javascript' src='util.js'></script>
    <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>
  </head>
  <body onload='brython()'>
    <script type='text/javascript'>
      function updateRhoP() {
        var rhoForP = document.getElementById("checkP").checked;
        var d = rhoForP ? "Rho" : "P";
        var e = rhoForP ? "P" : "Rho";
        document.getElementById("input"+d).setAttribute("disabled", "true");
        document.getElementById("input"+e).removeAttribute("disabled");
      }
      function myUpdatePlot() {
        updatePlot();
      }
      window.addEventListener("load", updateRhoP);
      window.addEventListener("load", updateX);
      window.addEventListener("load", function() {
        var plotModalEl = document.getElementById("plotModal");
        plotModalEl.addEventListener("show.bs.modal", myUpdatePlot);
      });

var copyText0 = "T,rho,P,U,A,G,Z,dZdrho,dPdrho,dGdrho,alpha\n";
var copyText = copyText0;
var allData = [];
function addParametricRow(T, rho, props) {
  console.log("here!");
  var tbody = document.getElementById("parametricResults");
  var row = makeElement("TR", tbody);
  var v = [];
  props['T'] = T;
  props['rho'] = rho;
  allData.push(props);
  var pnames = ['T','rho','P','U','A','G','Z','dZdrho','dPdrho','dGdrho','alpha'];
  for (var i=0; i<pnames.length; i++) {
    v.push(pnames[i] in props ? props[pnames[i]] : "");
  }
  for (var i=0; i<v.length; i++) {
    makeElement("TD", row, {textContent: v[i]});
  }
  copyText += v.join(",")+"\n";
}
function clearAllRows() {
  var tbody = document.getElementById("parametricResults");
  empty(tbody);
  allData = [];
}
    </script>
    <script type='text/python' src='LJ_EOS.py'></script>
    <script type='text/python' src='EOS_util.py'></script>
    <script type='text/python'>
      from browser import document, window, timer
      from browser.widgets.dialog import InfoDialog
      from LJ_EOS import getEOS
      from EOS_util import optsForPhase

      myInterval = eos = None
      alpha0 = True
      ix = numX = 0
      Tstr = rhostr = Pstr = ""

      def doOnePoint():
        global myInterval, Tstr, rhostr, Pstr, alpha0, eos, ix, numX
        if ix > numX:
          stopUpdate()
        x = ix / numX
        ix = ix + 1
        T = eval(Tstr)
        if document["checkP"].checked:
          P = eval(Pstr)
          rho = eos.rhoForProps(T, {'P': P})
        else:
          rho = eval(rhostr)
        props = eos.eval(T,rho)
        if alpha0:
          props['alpha'] = 1
        window.addParametricRow(T, rho, props)
        if ix > numX:
          stopUpdate()

      def stopUpdate():
        global eos, myInterval
        timer.clear_interval(myInterval)
        document["btnUpdate"].textContent = "Update"
        eos = None

      def update(ev):
        global myInterval, Tstr, rhostr, Pstr, alpha0, eos, ix, numX
        if not eos == None:
          print("stopping!")
          stopUpdate()
          return
        window.clearAllRows()
        window.copyText = window.copyText0
        window.collapseParameters()

        opts = optsForPhase("hcp", document, None)
        eos = getEOS('hcp', opts)

        Tstr = document['inputT'].value
        Pstr = document['inputP'].value
        rhostr = document['inputRho'].value

        useX = document["checkX"].checked
        if useX:
          document["btnUpdate"].textContent = "Stop"
          ix = 0
          numX = int(document["inputXnum"].value)
          if numX < 1:
            InfoDialog("Trouble", f"Need at least 1 x value")
            return
          myInterval = timer.set_interval(doOnePoint, 0)
          return

        try:
          T = float(Tstr)
        except ValueError:
          InfoDialog("Trouble", f"Must provide a valid temperature")
          return
        if document["checkP"].checked:
          try:
            P = float(Pstr)
          except ValueError:
            InfoDialog("Trouble", f"Must provide a valid pressure")
            return
          rho = eos.rhoForProps(T, {'P': P})
        else:
          try:
            rho = float(rhostr)
          except ValueError:
            InfoDialog("Trouble", f"Must provide a valid density ")
            return
        props = eos.eval(T,rho)
        document['T'].textContent = T
        document['rho'].textContent = rho
        for p in props:
          document[p].textContent = props[p]
        if alpha0:
          document["alpha"].textContent = "1"

      document["btnUpdate"].bind("click", update)
    </script>
    <div class='container'>
      <h1>Equation of State for HCP phase of LJ</h1>
      <div id='parametersDiv' class='card mb-4'>
        <div id='headingParameters' class='card-header' role='tab'>
          <h2 class='h5 mb-0'>Parameters</a></h2>
        </div>
        <div class='show' aria-labelledby='headingParameters'>
          <div class='card-body'>
            <div class='row'>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputT' class='col-form-label'>T</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputT' class='form-control'>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputRho' class='col-form-label'>&rho;</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputRho' class='form-control'>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputP' class='col-form-label'>P</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputP' class='form-control' disabled>
                  </div>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkP' onclick='updateRhoP()'>
                    <label class='form-check-label' for='checkP'>compute &rho; for P</label>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputXnum' class='col-form-label'>#</label>
                  </div>
                  <div class='col-auto'>
                    <input type='text' id='inputXnum' class='form-control' disabled placeholder='# of x values'>
                  </div>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkX' onclick='updateX()'>
                    <label class='form-check-label' for='checkX'>use T(x), &rho;(x) P(x) (0&lt;=x&lt;=1)</label>
                  </div>
                </div>
              </div>
        </div>
        <div class='row g-3 py-1 align-items-center'>
              <div class='col-auto'>
                <button id='btnUpdate' class='btn btn-sm btn-primary' type='button'>Update</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id='parametersDiv-hcp' class='card mb-4'>
        <div id='headingParameters-hcp' class='card-header' role='tab'>
          <h2 class='h5 mb-0'><a role='button' data-bs-toggle='collapse' href='#collapseparametersDiv-hcp' aria-expanded='true' aria-controls='colapseparametersDiv-hcp'>HCP Parameters</a></h2>
        </div>
        <div id='collapseparametersDiv-hcp' class='collapse show' role='tabpanel' aria-labelledby='headingParameters-hcp'>
          <div class='card-body'>
            <div class='row'>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputEOS-hcp' class='col-form-label'>EOS</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputEOS-hcp'>
                      <option value='Schultz' selected>Schultz</option>
                      <option value='Adidharma'>Adidharma</option>
                    </select>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkLat-hcp'>
                    <label class='form-check-label' for='checkLat-hcp'>lattice properties</label>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkHarmonic-hcp'>
                    <label class='form-check-label' for='checkHarmonic-hcp'>lattice+harmonic properties</label>
                  </div>
                </div>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto' class=form-check'>
                    <input class='form-check-input' type='checkbox' value='' id='checkAlpha'>
                    <label class='form-check-label' for='checkAlpha'>impose &alpha;=1</label>
                  </div>
                </div>
              </div>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
              <div class='col-auto'>
                <label for='inputNh' class='col-form-label'># of atoms</label>
              </div>
              <div class='col-auto'>
                <select class='form-select' id='inputNh'>
                  <option value='0' selected>&infin;</option>
                  <option value='4096'>4096</option>
                  <option value='1728'>1728</option>
                  <option value='1200'>1200</option>
                  <option value='1000'>1000</option>
                  <option value='512'>512</option>
                </select>
              </div>
            </div>
            <div class='row g-3 py-1 align-items-center'>
              <div class='col-auto'>
                <label for='rc-hcp' class='col-form-label'>cutoff</label>
              </div>
              <div class='col-auto'>
                <select class='form-select' id='inputRc-hcp'>
                  <option value='0' selected>&infin;</option>
                  <option value='11'>11</option>
                  <option value='9'>9</option>
                  <option value='7.5'>7.5</option>
                  <option value='6'>6</option>
                  <option value='5'>5</option>
                  <option value='4'>4</option>
                  <option value='3.5'>3.5</option>
                  <option value='3'>3</option>
                </select>
              </div>
            </div>
            <div class='row g-3 py-1 align-items-center'>
              <div class='col-auto' class=form-check'>
                <input class='form-check-input' type='checkbox' value='' id='checkNrcc-hcp'>
                <label class='form-check-label' for='checkNrcc-hcp'>apply only to anharmonic</label>
              </div>
            </div>
            <div class='row g-3 py-1 align-items-center'>
              <div class='col-auto' class=form-check'>
                <input class='form-check-input' type='checkbox' value='' id='checkLRC-hcp'>
                <label class='form-check-label' for='checkLRC-hcp'>include LRC</label>
              </div>
            </div>
          </div>
        </div>
          </div>
        </div>
      </div>

      <div id='resultsDiv' class='card'>
        <div id='headingResults' class='card-header' role='tab'>
          <h2 class='h5 mb-0' style='float: left'>Results</a></h2>
        <button class='btn btn-info btn-sm' style='float: right' onclick='copyToClipboard(copyText)' id='copyBtn'>Copy</button>
        <button class='btn btn-info btn-sm' style='margin-right: 1rem; float: right' id='plotBtn' data-bs-toggle="modal" data-bs-target="#plotModal">Plot</button>
        </div>
        <div class='show' aria-labelledby='headingResults'>
          <div class='card-body'>
            <div id='singleResultsDiv'>
            T: <span id='T'></span><br>
            &rho;: <span id='rho'></span><br>
            P: <span id='P'></span><br>
            U: <span id='U'></span><br>
            A: <span id='A'></span><br>
            G: <span id='G'></span><br>
            Z: <span id='Z'></span><br>
            dZdrho: <span id='dZdrho'></span><br>
            dPdrho: <span id='dPdrho'></span><br>
            dGdrho: <span id='dGdrho'></span><br>
            &alpha;: <span id='alpha'></span><br>
          </div>
          <div class='overflow-auto' id='parametricResultsDiv' style='display: none;'>
            <table class='table small'>
              <thead><tr><th>T</th><th>&rho;</th><th>P</th><th>U</th><th>A</th><th>G</th><th>Z</th><th>dZdrho</th><th>dPdrho</th><th>dGdrho</th><th>&alpha;</th></tr></thead>
              <tbody id='parametricResults'></tbody>
            </table>
          </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="plotModal" tabindex="-1" aria-labelledby="plotModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="plotModalLabel">Plot</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="plotDiv" style="width:100%;height:500px;"></div>
            <div class='row'>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputXprop' class='col-form-label'>X:</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputXprop' onchange='myUpdatePlot()'>
                      <option value='T'>T</option>
                      <option value='rho'>&rho;</option>
                      <option value='P'>P</option>
                      <option value='U'>U</option>
                      <option value='A'>A</option>
                      <option value='G'>G</option>
                      <option value='Z'>Z</option>
                      <option value='dZdrho'>dZdrho</option>
                      <option value='dZdrho'>dPdrho</option>
                      <option value='dGdrho'>dGdrho</option>
                      <option value='Cv'>Cv</option>
                      <option value='phi'>&phi;</option>
                      <option value='alpha'>&alpha;</option>
                      <option value='v2'>v2</option>
                      <option value='Y'>Y</option>
                      <option value='H'>H</option>
                      <option value='S'>S</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class='col-auto px-4'>
                <div class='row g-3 py-1 align-items-center'>
                  <div class='col-auto'>
                    <label for='inputYprop' class='col-form-label'>Y:</label>
                  </div>
                  <div class='col-auto'>
                    <select class='form-select' id='inputYprop' onchange='myUpdatePlot()'>
                      <option value='T'>T</option>
                      <option value='rho'>&rho;</option>
                      <option value='P'>P</option>
                      <option value='U'>U</option>
                      <option value='A'>A</option>
                      <option value='G'>G</option>
                      <option value='Z'>Z</option>
                      <option value='dZdrho'>dZdrho</option>
                      <option value='dZdrho'>dPdrho</option>
                      <option value='dGdrho'>dGdrho</option>
                      <option value='Cv'>Cv</option>
                      <option value='phi'>&phi;</option>
                      <option value='alpha'>&alpha;</option>
                      <option value='v2'>v2</option>
                      <option value='Y'>Y</option>
                      <option value='H'>H</option>
                      <option value='S'>S</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
